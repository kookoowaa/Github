for (i in names(x)[3:length(mailorder)]){
for (j in length(x$i){
x$i[j] = as.numeric(as.character(x$i[j])
}
}
}
## 1번 - 500명중에 hit-rate
dim(mail_sample[mail_sample$purchase==1,])[1]
dim(mail_sample[mail_sample$purchase==1,])[1]/500
## sampling
idx_test = sample(1:4000)>2000
mail_test = mailorder[idx_test,]
mail_validation = mailorder[!idx_test,]
## regroup by 2x2x2
for (i in length(mail_test$recency)){
if (mail_test$recency[i] >12) {mail_test}
}
RFM = function(x){
for (i in length(x$recency)){
if (x$recency[i] > 12) { x$recency[i] = 1}
else x$recency[i] = 2
}
}
RFM(mail_test)
rm(list=ls())
library(xlsx)
mailorder = read.xlsx2('../database_marketing/hw2/mailorder.xls', 1)
idx = sample(1:2000, size = 500)
mail_sample = mailorder[idx,]
head(mail_sample)
tonum = function(x){
for (i in names(x)[3:length(mailorder)]){
for (j in length(x$i){
x$i[j] = as.numeric(as.character(x$i[j])
}
}
}
## 1번 - 500명중에 hit-rate
dim(mail_sample[mail_sample$purchase==1,])[1]
dim(mail_sample[mail_sample$purchase==1,])[1]/500
## sampling
idx_test = sample(1:4000)>2000
mail_test = mailorder[idx_test,]
mail_validation = mailorder[!idx_test,]
## regroup by 2x2x2
for (i in length(mail_test$recency)){
if (mail_test$recency[i] >12) {mail_test}
}
RFM = function(x){
for (i in length(x$recency)){
if (x$recency[i] > 12) { x$recency[i] = 1}
else x$recency[i] = 2
}
}
RFM(mail_test)
rm(list=ls())
library(xlsx)
mailorder = read.xlsx2('../database_marketing/hw2/mailorder.xls', 1)
idx = sample(1:2000, size = 500)
mail_sample = mailorder[idx,]
head(mail_sample)
tonum = function(x){
for (i in names(x)[3:length(mailorder)]){
for (j in length(x$i){
x$i[j] = as.numeric(as.character(x$i[j])
}
}
}
tonum = function(x){
for (i in names(x)[3:length(mailorder)]){
for (j in length(x$i)){
x$i[j] = as.numeric(as.character(x$i[j])
}
}
}
## Factor > numeric
tonum = function(x){
for (i in names(x)[3:length(mailorder)]){
for (j in length(x$i)){
x$i[j] = as.numeric(as.character(x$i[j]))
}
}
}
tonum(mailorder)
str(mailorder)
mailorder$recency[1]
mailorder$recency = as.numeric(as.character(mailorder$recency))
str(mailorder)
tonum = function(x){
for (i in names(x)[3:length(mailorder)]){
x$i = as.numeric(as.character(x$i))
}
}
tonum(mailorder)
str(mailorder)
for (i in names(x)[3:length(mailorder)]){
print(i)}
for (i in names(mailorder)[3:length(mailorder)]){
print(i)}
length(mailorder
)
mailorder[3]
tonum = function(x){
for (i in 3:7){
x[i] = as.numeric(as.character(x[i]))
}
}
tonum(mailorder)
str(mailorder)
mailorder[3] = as.numeric(as.factor(mailorder[3]))
str(mailorder[3])
unclass(mailorder[3])
mailorder$monetary
?$`$,jclassName-method`
for (i in names(x)[3:length(mailorder)]){
print(mailorder$i)}
for (i in names(mailorder)[3:length(mailorder)]){
print(mailorder$i)}
for (i in names(mailorder)[3:length(mailorder)]){
print(head(mailorder$i))}
names(mailorder)
head(mailorder$purchase)
head(mailorder)
for (i in names(mailorder)[3:length(mailorder)]){
print(head(i))}
for (i in names(mailorder)[3:length(mailorder)]){
print(head(mailorder$+i))}
for (i in names(mailorder)[3:length(mailorder)]){
print(head(mailorder$i))}
for (i in names(mailorder)[3:length(mailorder)]){
print(head(paste0('mailorder$',i))}
paste0(mailorder,i)
head(paste0('mailorder',i))
for (i in names(mailorder)[3:length(mailorder)]){
print(paste0('mailorder$',i))}
for (i in names(mailorder)[3:length(mailorder)]){
paste0('mailorder$',i)}
names(mailorder)
rm(list=ls())
library(xlsx)
mailorder = read.xlsx2('../database_marketing/hw2/mailorder.xls', 1)
idx = sample(1:2000, size = 500)
mail_sample = mailorder[idx,]
head(mail_sample)
## Factor > numericd
mailorder$monetary = as.numeric(as.character(mailorder$monetary))
mailorder$recency = as.numeric(as.character(mailorder$recency))
mailorder$frequency = as.numeric(as.character(mailorder$frequency))
mailorder$duration = as.numeric(as.character(mailorder$duration))
## 1번 - 500명중에 hit-rate
dim(mail_sample[mail_sample$purchase==1,])[1]
dim(mail_sample[mail_sample$purchase==1,])[1]/500
## sampling
idx_test = sample(1:4000)>2000
mail_test = mailorder[idx_test,]
mail_validation = mailorder[!idx_test,]
str(mail_test)
RFM = function(x){
for (i in length(x$recency)){
if (x$recency[i] > 12) { x$recency[i] = 1}
else x$recency[i] = 2
}
}
RFM(mail_test)
head(mail_test)
length(mail_test$recency)
mail_test$recency[1]
mail_test$recency[1] >12
if(mail_test$recency[1>12])
if(mail_test$recency[1]>12)
mail_test$recency[1] = 1
head(mail_test)
library(xlsx)
mailorder = read.xlsx2('../database_marketing/hw2/mailorder.xls', 1)
idx = sample(1:2000, size = 500)
mail_sample = mailorder[idx,]
head(mail_sample)
## Factor > numericd
mailorder$monetary = as.numeric(as.character(mailorder$monetary))
mailorder$recency = as.numeric(as.character(mailorder$recency))
mailorder$frequency = as.numeric(as.character(mailorder$frequency))
mailorder$duration = as.numeric(as.character(mailorder$duration))
## 1번 - 500명중에 hit-rate
dim(mail_sample[mail_sample$purchase==1,])[1]
dim(mail_sample[mail_sample$purchase==1,])[1]/500
## sampling
idx_test = sample(1:4000)>2000
mail_test = mailorder[idx_test,]
mail_validation = mailorder[!idx_test,]
for (i in length(mail_test$recency)){
if (mail_test$recency[i] >12) {mail_test$recency = 1}
else mail_test$recency =2
}
head(mail_test)
mail_test[mail_test$recency==1,]
mail_test[mail_test$recency==2,]
library(xlsx)
mailorder = read.xlsx2('../database_marketing/hw2/mailorder.xls', 1)
idx = sample(1:2000, size = 500)
mail_sample = mailorder[idx,]
head(mail_sample)
## Factor > numericd
mailorder$monetary = as.numeric(as.character(mailorder$monetary))
mailorder$recency = as.numeric(as.character(mailorder$recency))
mailorder$frequency = as.numeric(as.character(mailorder$frequency))
mailorder$duration = as.numeric(as.character(mailorder$duration))
## 1번 - 500명중에 hit-rate
dim(mail_sample[mail_sample$purchase==1,])[1]
dim(mail_sample[mail_sample$purchase==1,])[1]/500
## sampling
idx_test = sample(1:4000)>2000
mail_test = mailorder[idx_test,]
mail_validation = mailorder[!idx_test,]
head(mail_test)
for (i in length(mail_test$recency)){
if (mail_test$recency[i] >12) {mail_test$recency = 1}
else mail_test$recency =2
}
head(mailt)
head(mail_test)
library(xlsx)
mailorder = read.xlsx2('../database_marketing/hw2/mailorder.xls', 1)
idx = sample(1:2000, size = 500)
mail_sample = mailorder[idx,]
head(mail_sample)
## Factor > numericd
mailorder$monetary = as.numeric(as.character(mailorder$monetary))
mailorder$recency = as.numeric(as.character(mailorder$recency))
mailorder$frequency = as.numeric(as.character(mailorder$frequency))
mailorder$duration = as.numeric(as.character(mailorder$duration))
## 1번 - 500명중에 hit-rate
dim(mail_sample[mail_sample$purchase==1,])[1]
dim(mail_sample[mail_sample$purchase==1,])[1]/500
## sampling
idx_test = sample(1:4000)>2000
mail_test = mailorder[idx_test,]
mail_validation = mailorder[!idx_test,]
for (i in length(mail_test$recency)){
if (mail_test$recency[i] >12) {mail_test$recency[i] = 1}
else mail_test$recency[i] =2
}
head(mail_test)
for (i in length(mail_test$recency)){
if (mail_test$recency[i] >12) {mail_test$recency[i] <- 1}
else mail_test$recency[i] <-2
}
head(mail_test)
library(xlsx)
mailorder = read.xlsx2('../database_marketing/hw2/mailorder.xls', 1)
idx = sample(1:2000, size = 500)
mail_sample = mailorder[idx,]
head(mail_sample)
## Factor > numericd
mailorder$monetary = as.numeric(as.character(mailorder$monetary))
mailorder$recency = as.numeric(as.character(mailorder$recency))
mailorder$frequency = as.numeric(as.character(mailorder$frequency))
mailorder$duration = as.numeric(as.character(mailorder$duration))
## 1번 - 500명중에 hit-rate
dim(mail_sample[mail_sample$purchase==1,])[1]
dim(mail_sample[mail_sample$purchase==1,])[1]/500
## sampling
mail_test = mailorder[1:2000,]
mail_validation = mailorder[2001:4000,]
head(mail_test)
for (i in 1:2000)){
if (mail_test$recency[i] >12) {mail_test$recency[i] <- 1}
else mail_test$recency[i] <-2
}
head(mail_test)
for (i in 1:2000){
if (mail_test$recency[i] >12) {mail_test$recency[i] <- 1}
else mail_test$recency[i] <-2
}
head(mail_test)
library(xlsx)
mailorder = read.xlsx2('../database_marketing/hw2/mailorder.xls', 1)
idx = sample(1:2000, size = 500)
mail_sample = mailorder[idx,]
head(mail_sample)
## Factor > numericd
mailorder$monetary = as.numeric(as.character(mailorder$monetary))
mailorder$recency = as.numeric(as.character(mailorder$recency))
mailorder$frequency = as.numeric(as.character(mailorder$frequency))
mailorder$duration = as.numeric(as.character(mailorder$duration))
## 1번 - 500명중에 hit-rate
dim(mail_sample[mail_sample$purchase==1,])[1]
dim(mail_sample[mail_sample$purchase==1,])[1]/500
## sampling
mail_test = mailorder[1:2000,]
mail_validation = mailorder[2001:4000,]
RFM = function(x){
for (i in 1:2000){
if (x$recency[i] > 12) { x$recency[i] = 1}
else x$recency[i] = 2
}
}
mail_test
head(mail_test)
RFM(mail_sample)
RFM(mail_test)
head(mail_test)
RFM = function(x){
for (i in 1:2000){
if (x$recency[i] > 12) { x$recency[i] <- 1}
else x$recency[i] <- 2
}
}
RFM(mail_test)
head(mail_test)
RFM = function(x, y){
for (i in 1:2000){
if (x$y[i] > 12) { x$y[i] <- 1}
else x$y[i] <- 2
}
}
RFM(mail_test,recency)
RFM('mail_test','recency')
head(mail_test[4])
mail_test[4][1]
mail_test[4][1][1]
mail_test[4][[1]]
str(mail_test[4])
str(mail_test[4][1])
str(mail_test[4][[1])
str(mail_test[4][[1]])
str(mail_test[4][[1]][1])
RFM = function(x){
for (i in 1:2000){
if (x[4][[1]][i] > 12) { x[4][[1]][i] <- 1}
else x[4][[1]][i] <- 2
}
}
head(mail_test)
RFM(mail_test)
head(mail_test)
RFM = function(x){
v = x[4][[1]]
for (i in 1:2000){
if (v[i] > 12) { v[i] <- 1}
else v[i] <- 2
}
x[4][[1]] = v
}
RFM(mail_test)
head(mail_test)
for (i in 1:2000){
if (mail_test$recency[i] >12) {mail_test$recency[i] <- 1}
else mail_test$recency[i] <-2
}
for (i in 1:2000){
if (mail_test$frequency[i] < 3) {mail_test$recency[i] <- 1}
else mail_test$frequency[i] <-2
}
for (i in 1:2000){
if (mail_test$monetary[i] < 209) {mail_test$recency[i] <- 1}
else mail_test$frequency[i] <-2
}
dim(mail_test[idx,])
dim(mail_test[idx,][mail_test$purchase==1,])
mail_test[idx,][mail_test$purchase==1,]
mail_test[idx,]
which(mail_test[idx,],mail_test$purchase==1)
?which
mail_test_vali = mail_test[idx,]
dim(mail_test_vali[mail_test$purchase==1,])[1]
dim(mail_test_vali[mail_test$purchase==1,])[1]/500
mail_test_vali[mail_test$purchase==1,]
mail_test_vali[mail_test_vali$purchase==1,]
dim(mail_test_vali[mail_test_vali$purchase==1,])[1]
dim(mail_test_vali[mail_test_vali$purchase==1,])[1]/500
mail_test_vali = mail_test[mail_test$recency==2 & mail_test$frequency==2 & mail_test$monetary==2]
dim(mail_test_vali[mail_test_vali$purchase==1,])[1]
mail_test_vali
mail_test_vali = mail_test[mail_test$recency==2 & mail_test$frequency==2 & mail_test$monetary==2,]
mail_test_vali
library(xlsx)
mailorder = read.xlsx2('../database_marketing/hw2/mailorder.xls', 1)
head(mail_sample)
## Factor > numericd
mailorder$monetary = as.numeric(as.character(mailorder$monetary))
mailorder$recency = as.numeric(as.character(mailorder$recency))
mailorder$frequency = as.numeric(as.character(mailorder$frequency))
mailorder$duration = as.numeric(as.character(mailorder$duration))
## 1번 - 500명중에 hit-rate
idx = sample(1:2000, size = 500)
mail_sample = mailorder[idx,]
dim(mail_sample[mail_sample$purchase==1,])[1]
dim(mail_sample[mail_sample$purchase==1,])[1]/500
## sampling
mail_test = mailorder[1:2000,]
mail_validation = mailorder[2001:4000,]
## regroup by 2x2x2
for (i in 1:2000){
if (mail_test$recency[i] >12) {mail_test$recency[i] <- 1}
else mail_test$recency[i] <-2
}
for (i in 1:2000){
if (mail_test$frequency[i] < 3) {mail_test$recency[i] <- 1}
else mail_test$frequency[i] <-2
}
for (i in 1:2000){
if (mail_test$monetary[i] < 209) {mail_test$monetary[i] <- 1}
else mail_test$monetary[i] <-2
mail_test_vali = mail_test[mail_test$recency==2 & mail_test$frequency==2 & mail_test$monetary==2,]
for (i in 1:2000){
if (mail_test$monetary[i] < 209) {mail_test$monetary[i] <- 1}
else mail_test$monetary[i] <-2
}
mail_test_vali = mail_test[mail_test$recency==2 & mail_test$frequency==2 & mail_test$monetary==2,]
dim(mail_test_vali[mail_test_vali$purchase==1,])[1]
dim(mail_test_vali[mail_test_vali$purchase==1,])[1]/305
table(mail_test)
table(mail_test$purchase, mail_test$monetary)
table(mail_test$purchase, mail_test$monetary, mail_test$recency)
library(dplyr)
mail_test%>%
summarize(summary())
mail_test%>%
group_by(recency, frequency, monetary)%>%
tally()
mail_test%>%
group_by(recency, frequency, monetary, purchase)%>%
tally()
mail_test%>%
group_by(recency, frequency, monetary, purchase)%>%
tally() -> a
a
a%>%
arrange(purchase)
a%>%
arrange(-purchase)
a%>%
arrange(desc(purchase))
fit = lm(purchase~monetary+recency+frequency, data = mailorder)
summary(fit)
head(mailorder)
str(mailorder)
mailorder$purchase = as.numeric(as.character(mailorder$purchase))
fit = lm(purchase~monetary+recency+frequency, data = mailorder)
summary(fit)
library(xlsx)
mailorder = read.xlsx2('../database_marketing/hw2/mailorder.xls', 1)
head(mail_sample)
## Factor > numericd
mailorder$monetary = as.numeric(as.character(mailorder$monetary))
mailorder$recency = as.numeric(as.character(mailorder$recency))
mailorder$frequency = as.numeric(as.character(mailorder$frequency))
mailorder$duration = as.numeric(as.character(mailorder$duration))
mailorder$purchase = as.numeric(as.character(mailorder$purchase))
## 1번 - 500명중에 hit-rate
idx = sample(1:2000, size = 500)
mail_sample = mailorder[idx,]
dim(mail_sample[mail_sample$purchase==1,])[1]
dim(mail_sample[mail_sample$purchase==1,])[1]/500
## sampling
mail_test = mailorder[1:2000,]
mail_validation = mailorder[2001:4000,]
fit = lm(purchase~monetary+recency+frequency, data = mail_test)
predict(fit, newdata = mail_validation)
fit = glm(purchase~monetary+recency+frequency, data = mail_test, family = binomial)
summary(fit)
predict(fit, newdata = mail_validation)
predict(fit)
predict.glm(fit)
predict.glm(fit, family = binomial)
predict(fit, type = 'response')
test = predict(fit, type = 'response')
result = rep('down',2000)
result[test>0.5] = 'up'
table(result)
result[test>0.3] = 'up'
table(result)
sort(result)
sort(test)
test
b = sort(test)[1501:2000]
b
names(b)
mailorder[mailorder$id==names(b)]
mailorder$id
mailorder$id = as.numeric(as.character(mailorder$id))
mailorder[mailorder$id==as.numeric(names(b)),]
mailorder[mailorder$id==as.numeric(names(b))]
as.numeric(names(b))
mail_test[as.numeric(names(b))]
mail_test[as.numeric(names(b)),]
fit
mail_test[as.numeric(names(b)) & mail_test$purchase==1,]
length(mail_test[as.numeric(names(b)) & mail_test$purchase==1,])
dim(mail_test[as.numeric(names(b)) & mail_test$purchase==1,])
163/500
summary(fit)
summary(lm(purchase~monetary+recency+frequncy, family = binomial))
summary(lm(purchase~monetary+recency+frequncy, data = mail_test))
summary(lm(purchase~monetary+recency+frequency, data = mail_test))
lmfit = lm(purchase~monetary+recency+frequency, data = mail_test)
predict(lmfit, newdata = mail_validation, type = 'response')
a = predict(lmfit, newdata = mail_validation, type = 'response')
sort(a)[-1]
a = predict(lmfit, type = 'response')
sort(a)[1501:]
sort(a)[1501:2000]
b = sort(a)[1501:2000]
names(b)
mail_test[names(b)]
mail_test[as.numeric(names(b))]
mail_test[as.numeric(names(b)),]
dim(mail_test[as.numeric(names(b)),])
mail_test[as.numeric(names(b))&mail_test$purchase==1,]
dim(mail_test[as.numeric(names(b))&mail_test$purchase==1,])
163/500
lmfit
