unique(is.na(aggr1$prod_num))
rm(aggrcmd)
aggr1
unique(aggr1$prod_num)
uniq_prod_num = unique(aggr1$prod_num)
[1,2] %in% [1,2,3]
([1,2] %in% [1,2,3])
(c(1,2) %in% c(1,2,3))
rd[rd$자재코드 %in% uniq_prod_num, ]
39900777 %in% uniq_prod_num
raw_data = rd[rd$자재코드 %in% uniq_prod_num, ]
raw_data
write.csv(raw_data, 'd:/cns_data/raw_data.csv')
raw_data = rd[rd$자재코드 %in% uniq_prod_num, -1]
raw_data
promo = strsplit(as.character(raw_data$할인행사여부), ' ')
promo1 = list()
for (i in 1:length(promo)){
promo1[i] = promo[[i]][2]
}
promo1 = as.factor(unlist(promo1))
raw_data$할인행사여부 = promo1
rm('promo', 'promo1')
raw_data
summary(raw_data$할인행사여부)
colnames(raw_data)
colnames(raw_data)[1]
colnames(raw_data)[1] = '년월일'
colnames(raw_data)
raw_data = raw_data[,-11]
colnames(raw_data)
write.csv(raw_data, 'd:/cns_data/raw_data.csv')
raw_data
barplot(raw_data$할인행사여부)
barplot(table(raw_data$할인행사여부))
barplot(table(raw_data$할인행사여부), col = c(1,2))
barplot(table(raw_data$할인행사여부), col = c(2,4))
table(raw_data$할인행사여부)
Sys.setlocale('english')
Sys.setlocale('English')
Sys.setlocale(English)
Sys.setlocale(category = "LC_ALL", locale = "us")
table(raw_data$할인행사여부)
Sys.setlocale(category = "LC_ALL", locale = "KR")
Sys.setlocale("LC_ALL", "ko_KR.UTF-8")
table(raw_data$할인행사여부)
Sys.setlocale("LC_ALL", "ko_KR")
Sys.setlocale("LC_ALL", "KR")
table(raw_data$할인행사여부)
raw_data
raw_data = read.csv('d:/cns_data/raw_data.csv')
table(raw_data$할인행사여부)
Sys.setlocale("LC_ALL", "ko_KR.UTF-8")
table(raw_data$할인행사여부)
Sys.getlocale()
table(raw_data$할인행사여부)
table(raw_data$할인행사여부)
table(raw_data$X)
raw_data$X
raw_data
raw_data = read.csv('d:/cns_data/raw_data.csv')[,-1]
raw_data
library(dplyr)
raw_data %>% group_by(년월일) %>% summarize(volume = sum(판매수량), sales = sum(매출액))
aggr_by_date = raw_data %>% group_by(년월일) %>% summarize(volume = sum(판매수량), sales = sum(매출액))
plot(aggr_by_date$sales)
plot(aggr_by_date$sales, type = 'l')
library(ggplot2)
ggplot(data = aggr_by_date)
ggplot(data = aggr_by_date)+
geom_point(aes(x = 년월일, y = sales))
aggr_by_date
as.Date(raw_data$년월일)
as.Date(raw_data$년월일, format = "%Y%m%d"")
table(raw_data)
as.Date(raw_data$년월일, format = "%Y%m%d")
as.Date(raw_data$년월일, format = "%Y%m%d")
as.Date(as.character(raw_data$년월일), format = "%Y%m%d")
as.character(raw_data$년월일)
raw_data = read.csv('d:/cns_data/raw_data.csv')[,-1]
as.Date(aggr_by_date$년월일)
as.Date(as.character(aggr_by_date$년월일))
as.Date(as.character(aggr_by_date$년월일), format = '%Y%m%d')
aggr_by_date$년월일 = as.Date(as.character(aggr_by_date$년월일), format = '%Y%m%d')
ggplot(data = aggr_by_date)+
geom_point(aes(x = 년월일, y = sales))
ggplot(data = aggr_by_date)+
geom_line(aes(x = 년월일, y = sales))
ggplot(data = aggr_by_date)+
geom_line(aes(x = 년월일, y = volume))
ggplot(data = aggr_by_date)+
geom_line(aes(x = 년월일, y = sales))
min(aggr_by_date$sales)
max(aggr_by_date$sales)
min(aggr_by_date$volume), max(aggr_by_date$volume)
(min(aggr_by_date$volume), max(aggr_by_date$volume))
c(min(aggr_by_date$volume), max(aggr_by_date$volume))
ggplot(data = aggr_by_date)+
geom_bar(aes(x = 년월일, y = sales))
ggplot(data = aggr_by_date)+
geom_bar(할인행사여부)
ggplot(data = aggr_by_date)+
geom_bar(aes(할인행사여부))
ggplot(data = aggr_by_date)+
geom_line(aes(x = 년월일, y = sales))
ggplot(data = aggr_by_date)+
geom_boxplot(할인행사여부)
ggplot(data = raw_data)+
geom_boxplot(할인행사여부)
ggplot(data = raw_data$할인행사여부)+
geom_boxplot()
ggplot(data = table(raw_data$할인행사여부))+
geom_boxplot()
ggplot(data = data.frame(raw_data$할인행사여부))+
geom_boxplot()
ggplot(data = data.frame(table(raw_data$할인행사여부)))+
geom_boxplot()
data.frame(table(raw_data$할인행사여부))
ggplot(data = data.frame(table(raw_data$할인행사여부)))+
geom_boxplot(aes(x = Var1, y = Freq))
ggplot(data = data.frame(table(raw_data$할인행사여부)))+
geom_bar(aes(x = Var1, y = Freq))
boxplot(table(raw_data$할인행사여부))
barplot(table(raw_data$할인행사여부))
barplot(table(raw_data$할인행사여부), col = c(3,4))
table(raw_data$브랜드)
data.frame(table(raw_data$브랜드))
matrix(table(raw_data$브랜드)
matrix(table(raw_data$브랜드))
matrix(table(raw_data$브랜드))
data.frame(table(raw_data$브랜드)
data.frame(table(raw_data$브랜드))
table(raw_data$브랜드)
summary(table(raw_data$브랜드))
table(raw_data$브랜드)
length(table(raw_data$브랜드))
table(raw_data$브랜드)
table(raw_data$브랜드)
length(table(raw_data$브랜드))
table(raw_data$라인)
length(table(raw_data$라))
c(length(table(raw_data$라인)), min(table(raw_data$라인)), max(table(raw_data$라인)))
table(raw_data$유형)
table(raw_data$유형)
length(table(raw_data$유))
table(raw_data$유형)
c(length(table(raw_data$유형)), min(table(raw_data$유형)), max(table(raw_data$유형)))
table(raw_data$브랜드)
c(length(table(raw_data$브랜드)), min(table(raw_data$브랜드)), max(table(raw_data$브랜드)))
raw_data$년월일 = as.Date(as.character(raw_data$년월일), format = "%Y%m%d")
aggr_by_prod = raw_data %>% group_by(자재번호) %>% summarize(volume = sum(판매수량), sales = sum(매출액))
aggr_by_prod = raw_data %>% group_by(자재코) %>% summarize(volume = sum(판매수량), sales = sum(매출액))
aggr_by_prod = raw_data %>% group_by(자재코드) %>% summarize(volume = sum(판매수량), sales = sum(매출액))
aggr_by_prod
raw_data
aggr_by_prod = raw_data %>% group_by(자재코드) %>% summarize(prod_name = 제품명[1], volume = sum(판매수량), sales = sum(매출액))
aggr_by_prod
aggr_by_prod = raw_data %>% group_by(자재코드) %>% summarize(prod_name = 제품명[1], volume = sum(판매수량), sales = sum(매출액))
aggr_by_prod %>% arrange(desc(sales))
aggr_by_prod %>% arrange(desc(volume))
table(raw_data$BM)
c(length(table(raw_data$BM)), min(table(raw_data$BM)), max(table(raw_data$BM)))
library(dplyr)
raw_data = read.csv('d:/cns_data/raw_data.csv')[,-1]
raw_data$년월일 = as.Date(as.character(raw_data$년월일), format = "%Y%m%d")
raw_data
promo = read.csv('d:/cns_data/promotion.csv')
promo = promo[promo$프로모션종료일>=20150101,]
promo = promo[,-c(5,6)]
promo$프로모션시작일 = as.Date(as.character(promo$프로모션시작일), format = "%Y%m%d")
promo$프로모션종료일 = as.Date(as.character(promo$프로모션종료일), format = "%Y%m%d")
promo
raw_data$프로모션정보 = NA
raw_data$프로모션명칭 = NA
raw_data$할인내용 = NA
raw_data
promo$프로모션정보 = as.character(promo$프로모션정보)
promo$프로모션명칭 = as.character(promo$프로모션명칭)
promo$할인내용 = as.character(promo$할인내용)
promo = promo[complete.cases(promo),]
unique(promo$자재코드[promo$자재코드 %in% raw_data$자재코드])
unique(promo$자재코드[promo$자재코드 %in% raw_data$자재코드])[,,-1]
unique(promo$자재코드[promo$자재코드 %in% raw_data$자재코드])[,,]
rev(unique(promo$자재코드[promo$자재코드 %in% raw_data$자재코드]))
rev(unique(promo$자재코드[promo$자재코드 %in% raw_data$자재코드]))[length(unique(promo$자재코드[promo$자재코드 %in% raw_data$자재코드]))]
unique(promo$자재코드[promo$자재코드 %in% raw_data$자재코드])
for (n in rev(unique(promo$자재코드[promo$자재코드 %in% raw_data$자재코드])))
{
x = raw_data[raw_data$자재코드==n,]
y = promo[promo$자재코드==n,]
ptm <- proc.time()
print(paste(which(n==unique(promo$자재코드[promo$자재코드 %in% raw_data$자재코드])),'/ 1780'))
for(i in 1:nrow(x))
{
for (m in 1:nrow(y))
{
if (x[i,1] >= y[m,3] & x[i,1] <= y[m,4])
{
x[i,]$프로모션정보 = as.character(y[m,]$프로모션정보)
x[i,]$프로모션명칭 = as.character(y[m,]$프로모션명칭)
x[i,]$할인내용 = as.character(y[m,]$할인내용)
raw_data[raw_data$자재코드==n,][i,] = x[i,]
}
}
}
el.time <- proc.time() - ptm
print(el.time)
}
unique(raw_data$프로모션정보)
library(dplyr)
raw_data %>% filter(자재코드 ==unique(promo$자재코드[promo$자재코드 %in% raw_data$자재코드])[1])
promo %>% filter(자재코드 ==unique(promo$자재코드[promo$자재코드 %in% raw_data$자재코드])[1])
y = promo %>% filter(자재코드 ==unique(promo$자재코드[promo$자재코드 %in% raw_data$자재코드])[1])
y
library(dplyr)
raw_data %>% filter(자재코드 ==unique(promo$자재코드[promo$자재코드 %in% raw_data$자재코드])[1]) %>% mutate(프로모션정보 = if(년월일 >= y$프로모션시작일 & 년월일 >=y$프로모션종료일){y$프로모션정보})
raw_data %>% filter(자재코드 ==unique(promo$자재코드[promo$자재코드 %in% raw_data$자재코드])[1]) %>% mutate(프로모션정보 = 1)
library(dplyr)
raw_data %>% filter(자재코드 ==unique(promo$자재코드[promo$자재코드 %in% raw_data$자재코드])[1]) %>% mutate(프로모션정보 = if(년월일 >= y$프로모션시작일 & 년월일 >=y$프로모션종료일){as.character(y$프로모션정보)})
as.character(y$프로모션정보)
library(dplyr)
library(ggplot2)
raw_data = read.csv('d:/cns_data/raw_data2.csv')
library(dplyr)
library(ggplot2)
raw_data = read.csv('d:/cns_data/raw_data2.csv', stringsAsFactors = F)
raw_data = raw_data[,-1]
raw_data = raw_data[,c(1,6,7,2,8,9,11:13,3,4,10,5)]
colnames(raw_data) = c('date', 'UPC', 'prod_name', 'promotion', 'volume', 'sales', 'promo_info', 'promo_title', 'promo_detail', 'brand', 'line', 'BM', 'type')
raw_data = raw_data %>% mutate('s/v' = as.integer(sales/volume))
raw_data = raw_data[,c(1:6,14,7:13)]
raw_data = raw_data %>% filter(volume>0) %>% filter(sales>0)
raw_data = raw_data %>% filter(BM != '기타/판촉')
raw_data[(raw_data$promotion=='비할인행사'& is.na(raw_data$promo_info)), ]$promotion
raw_data[(raw_data$promotion=='비할인행사'& is.na(raw_data$promo_info)), ]$promotion = '비행사제품(추정)'
raw_data
raw_data
write.csv(raw_data, 'd:/cns_data/raw_data.csv')
raw_data = read.csv('d:/cns_data/raw_data.csv', stringsAsFactors = F)
raw_data = read.csv('d:/cns_data/raw_data.csv')
raw_data = read.csv('d:/cns_data/raw_data.csv')
```
raw_data
raw_data %>% group_by(UPC) %>% tally() %>% arrange(n)
raw_data %>% group_by(UPC) %>% tally() %>% arrange(desc(n))
raw_data %>% filter(UPC==30100095)
raw_data %>% filter(UPC==33900023)
raw_data %>% filter(date >2015-01-15, date < 2015-01-22)
raw_data %>% filter(date >2015-01-15)
raw_data %>% filter(date >as.Date(2015-01-15), date < as.Date(2015-01-22))
raw_data %>% filter(date == '2015-01-16')
raw_data = read.csv('d:/cns_data/raw_data.csv')[,-1]
library(dplyr)
library(ggplot2)
raw_data = read.csv('d:/cns_data/raw_data2.csv')[,-1]
raw_data
raw_data = raw_data[,c(1,6,7,2,8,9,11:13,3,4,10,5)]
colnames(raw_data) = c('date', 'UPC', 'prod_name', 'promotion', 'volume', 'sales', 'promo_info', 'promo_title', 'promo_detail', 'brand', 'line', 'BM', 'type')
raw_data = raw_data %>% mutate('s/v' = as.integer(sales/volume))
raw_data = raw_data[,c(1:6,14,7:13)]
#raw_data = raw_data %>% filter(volume>0) %>% filter(sales>0)
#raw_data = raw_data %>% filter(BM != '기타/판촉')
raw_data[(raw_data$promotion=='비할인행사'& is.na(raw_data$promo_info)), ]$promotion = '비행사제품(추정)'
write.csv(raw_data, 'd:/cns_data/raw_data.csv')
raw_data
raw_data %>% filter(UPC==30100095)
which(raw_data$UPC==30100095)
raw_data[which(raw_data$UPC==30100095),]
which(raw_data$UPC==30100095)
rep(1:length(which(raw_data$UPC==30100095)), by=2)
seq(1:length(which(raw_data$UPC==30100095)), by=2)
seq(1, length(which(raw_data$UPC==30100095)), by=2)
which(raw_data$UPC==30100095)[seq(1, length(which(raw_data$UPC==30100095)), by=2)]
raw_data[-which(raw_data$UPC==30100095)[seq(1, length(which(raw_data$UPC==30100095)), by=2),]
raw_data[-which(raw_data$UPC==30100095)[seq(1, length(which(raw_data$UPC==30100095)), by=2),]
-which(raw_data$UPC==30100095)[seq(1, length(which(raw_data$UPC==30100095)), by=2)
-which(raw_data$UPC==30100095)[seq(1, length(which(raw_data$UPC==30100095)), by=2)
-which(raw_data$UPC==30100095)[seq(1, length(which(raw_data$UPC==30100095)), by=2)
raw_data[-c(which(raw_data$UPC==30100095)[seq(1, length(which(raw_data$UPC==30100095)), by=2)),]
raw_data[-c(which(raw_data$UPC==30100095)[seq(1, length(which(raw_data$UPC==30100095)), by=2)),]
raw_data[-which(raw_data$UPC==30100095)[seq(1, length(which(raw_data$UPC==30100095)), by=2),]]
-which(raw_data$UPC==30100095)
-which(raw_data$UPC==30100095)[seq(1, length(which(raw_data$UPC==30100095)), by=2),]
-which(raw_data$UPC==30100095)[seq(1, length(which(raw_data$UPC==30100095)), by=2),]
seq(1, length(which(raw_data$UPC==30100095)), by=2)
raw_data[-which(raw_data$UPC==30100095)[seq(1, length(which(raw_data$UPC==30100095)), by=2)],]
raw_data = raw_data[-which(raw_data$UPC==30100095)[seq(1, length(which(raw_data$UPC==30100095)), by=2)],]
raw_data %>% group_by(UPC) %>% tally() %>% arrange(desc(n))
write.csv(raw_data, 'd:/cns_data/raw_data.csv')
raw_data %>% filter(volume>0) %>% filter(sales>0)
raw_data %>% filter(volume<=0) %>% filter(sales>=0)
raw_data
max(as.Date(raw_data$date))
raw_data %>% group_by(UPC) %>% tally() %>% arrange(desc(n))
raw_data %>% group_by(UPC) %>% tally('count') %>% arrange(desc(n))
raw_data %>% group_by(UPC) %>% tally() %>% arrange(desc(n))
raw_data %>% group_by(UPC) %>% tally('count') %>% arrange(desc(count))
raw_data %>% group_by(UPC) %>% tally() %>% arrange(desc(n))
raw_data$date %>% filter(raw_data$UPC==UPC
raw_data %>% group_by(UPC) %>% tally() %>% arrange(desc(n)) %>% mutate('st_date' = min(as.Date(raw_data$date %>% filter(raw_data$UPC==UPC))))
UPC = raw_data %>% group_by(UPC) %>% tally() %>% arrange(desc(n))
UPC
upc = raw_data %>% group_by(UPC) %>% tally() %>% arrange(desc(n))
upc
raw_data$date = as.Date(raw_data$date)
raw_data
raw_data %>% filter(UPC==upc[1,1])
upc[1,1]
raw_data %>% filter(UPC==unclass(upc[1,1]))
raw_data %>% filter(UPC==unclass(upc[1,1])) %>% min_rank(date)
raw_data %>% filter(UPC==unclass(upc[1,1])) %>% min(date)
raw_data %>% filter(UPC==unclass(upc[1,1])) %>% summarize(min(date))
raw_data %>% filter(UPC==unclass(upc[1,1])) %>% summarize(min(date), max(date))
raw_data %>% filter(UPC==unclass(upc[1,1])) %>% summarize(min(date), max(date)-min(date))
raw_data %>% filter(UPC==unclass(upc[1,1])) %>% summarize(min(date), max(date)-min(date)+1)
raw_data %>% filter(UPC==unclass(upc[1,1])) %>% summarize(max(date)-min(date)+1) %>% unclass
raw_data %>% filter(UPC==unclass(upc[1,1])) %>% summarize(max(date)-min(date)+1) %>% unclass +10
raw_data %>% filter(UPC==unclass(upc[1,1])) %>% summarize(max(date)-min(date)+1) %>% unclass()
raw_data %>% filter(UPC==unclass(upc[1,1])) %>% summarize(max(date)-min(date)+1)
raw_data %>% filter(UPC==unclass(upc[1,1])) %>% as.numeric(summarize(max(date)-min(date)+1))
raw_data %>% filter(UPC==unclass(upc[1,1])) %>% summarize(max(date)-min(date)+1)
upc$dates = NA
upc[i,3] = raw_data %>% filter(UPC==unclass(upc[i,1])) %>% summarize(max(date)-min(date)+1)
{
upc[i,3] = raw_data %>% filter(UPC==unclass(upc[i,1])) %>% summarize(max(date)-min(date)+1)
}
{
upc[i,3] = raw_data %>% filter(UPC==unclass(upc[i,1])) %>% summarize(max(date)-min(date)+1)
}
for(i in 1:nrow(upc)){
upc[i,3] = raw_data %>% filter(UPC==unclass(upc[i,1])) %>% summarize(max(date)-min(date)+1)
}
upc
for(i in 1:nrow(upc)){
upc[i,3] = raw_data %>% filter(UPC==unclass(upc[i,1])) %>% summarize(min(date))
upc[i,4] = raw_data %>% filter(UPC==unclass(upc[i,1])) %>% summarize(max(date))
upc[i,5] = upc[i,4]-upc[i,3]+1
}
upc
as.Date(16436)
as.Date
as.Date(16436, origin="1970-01-01")
for(i in 1:nrow(upc)){
upc[i,3] = as.Date(raw_data %>% filter(UPC==unclass(upc[i,1])) %>% summarize(min(date)), origin="1970-01-01")
upc[i,4] = as.Date(raw_data %>% filter(UPC==unclass(upc[i,1])) %>% summarize(max(date)), origin="1970-01-01")
upc[i,5] = upc[i,4]-upc[i,3]+1
}
upc[,3]
upc[,3] = as.Date(upc[,3], origin="1970-01-01")
upc[,3]
for(i in 1:nrow(upc)){
upc[i,3] = raw_data %>% filter(UPC==unclass(upc[i,1])) %>% summarize(min(date))
upc[i,3] = as.Date(upc[i,3],origin="1970-01-01")
upc[i,4] = raw_data %>% filter(UPC==unclass(upc[i,1])) %>% summarize(max(date))
upc[i,4] = as.Date(upc[i,3],origin="1970-01-01")
upc[i,5] = upc[i,4]-upc[i,3]+1
}
upc
upc[i,3]
as.Date(unclass(upc[i,3]),origin="1970-01-01")
unclass(upc[i,3])
as.Date(unclass(upc[i,3])$dates,origin="1970-01-01")
as.Date(unclass(raw_data %>% filter(UPC==unclass(upc[i,1])) %>% summarize(min(date)))$dates,origin="1970-01-01")
unclass(raw_data %>% filter(UPC==unclass(upc[i,1])) %>% summarize(min(date)))$dates
for(i in 1:nrow(upc)){
upc[i,3] = as.Date(unclass(raw_data %>% filter(UPC==unclass(upc[i,1])) %>% summarize(min(date)))$dates,origin="1970-01-01")
#upc[i,3] = as.Date(unclass(upc[i,3])$dates,origin="1970-01-01")
upc[i,4] = as.Date(unclass(raw_data %>% filter(UPC==unclass(upc[i,1])) %>% summarize(max(date)))$dates,origin="1970-01-01")
#upc[i,4] = as.Date(upc[i,3],origin="1970-01-01")
upc[i,5] = upc[i,4]-upc[i,3]+1
}
unclass(raw_data %>% filter(UPC==unclass(upc[i,1])) %>% summarize(min(date)))
upc[i,4] = as.Date(unclass(raw_data %>% filter(UPC==unclass(upc[i,1])) %>% summarize(max(date)))$max(date),origin="1970-01-01")
for(i in 1:nrow(upc)){
upc[i,3] = as.Date(unclass(raw_data %>% filter(UPC==unclass(upc[i,1])) %>% summarize(min(date)))$min(date),origin="1970-01-01")
#upc[i,3] = as.Date(unclass(upc[i,3])$dates,origin="1970-01-01")
upc[i,4] = as.Date(unclass(raw_data %>% filter(UPC==unclass(upc[i,1])) %>% summarize(max(date)))$max(date),origin="1970-01-01")
#upc[i,4] = as.Date(upc[i,3],origin="1970-01-01")
upc[i,5] = upc[i,4]-upc[i,3]+1
}
unclass(raw_data %>% filter(UPC==unclass(upc[i,1])) %>% summarize(min(date)))$min(date)
unclass(raw_data %>% filter(UPC==unclass(upc[i,1])) %>% summarize(min(date)))
unclass(raw_data %>% filter(UPC==unclass(upc[i,1])) %>% summarize(min(date)))$'min(date)'
for(i in 1:nrow(upc)){
upc[i,3] = as.Date(unclass(raw_data %>% filter(UPC==unclass(upc[i,1])) %>% summarize(min(date)))$'min(date)',origin="1970-01-01")
#upc[i,3] = as.Date(unclass(upc[i,3])$dates,origin="1970-01-01")
upc[i,4] = as.Date(unclass(raw_data %>% filter(UPC==unclass(upc[i,1])) %>% summarize(max(date)))$'max(date)',origin="1970-01-01")
#upc[i,4] = as.Date(upc[i,3],origin="1970-01-01")
upc[i,5] = upc[i,4]-upc[i,3]+1
}
upc
as.Date(unclass(raw_data %>% filter(UPC==unclass(upc[i,1])) %>% summarize(min(date)))$'min(date)',origin="1970-01-01")
as.Date(upc[,3])
upc
as.Date(upc$dates)
as.Date(upc$dates, origin = '1970-01-01')
upc
upc = raw_data %>% group_by(UPC) %>% tally() %>% arrange(desc(n))
for(i in 1:nrow(upc)){
upc[i,3] = as.Date(unclass(raw_data %>% filter(UPC==unclass(upc[i,1])) %>% summarize(min(date)))$'min(date)',origin="1970-01-01")
#upc[i,3] = as.Date(unclass(upc[i,3])$dates,origin="1970-01-01")
upc[i,4] = as.Date(unclass(raw_data %>% filter(UPC==unclass(upc[i,1])) %>% summarize(max(date)))$'max(date)',origin="1970-01-01")
#upc[i,4] = as.Date(upc[i,3],origin="1970-01-01")
upc[i,5] = upc[i,4]-upc[i,3]+1
}
upc
#as.Date(upc$dates, origin = '1970-01-01')
upc %>% mutate(if_else(V4.1>n,'F','M'))
upc %>% mutate(if_else(V4.1>n,'F','T'))
upc = upc %>% mutate(if_else(V4.1>n,'F','T'))
upc = upc[,c(1,6,2:5)]
upc
upc = raw_data %>% group_by(UPC) %>% tally() %>% arrange(desc(n))
for(i in 1:nrow(upc)){
upc[i,3] = as.Date(unclass(raw_data %>% filter(UPC==unclass(upc[i,1])) %>% summarize(min(date)))$'min(date)',origin="1970-01-01")
#upc[i,3] = as.Date(unclass(upc[i,3])$dates,origin="1970-01-01")
upc[i,4] = as.Date(unclass(raw_data %>% filter(UPC==unclass(upc[i,1])) %>% summarize(max(date)))$'max(date)',origin="1970-01-01")
#upc[i,4] = as.Date(upc[i,3],origin="1970-01-01")
upc[i,5] = upc[i,4]-upc[i,3]+1
}
upc$V3 = as.Date(upc$V3, origin = '1970-01-01')
upc$V4 = as.Date(upc$V4, origin = '1970-01-01')
upc = upc %>% mutate(if_else(V4.1>n,'F','T'))
upc = upc[,c(1,6,2:5)]
colnames(upc)[2:6] = c('T/F', 'n', 'start', 'end', 'duration')
upc
#as.Date(upc$dates, origin = '1970-01-01')
upc %>% filter(n=='F')
upc %>% filter(T/F=='F')
upc
upc %>% filter('T/F'=='F')
colnames(upc)[2:6] = c('test', 'n', 'start', 'end', 'duration')
upc %>% filter(test=='F')
upc %>% filter(n>duration)
raw_data %>% filter(UPC==30100095)
raw_data %>% group_by(UPC) %>% tally() %>% arrange(desc(n))
raw_data %>% group_by(UPC, prod_name) %>% tally() %>% arrange(desc(n))
raw_data %>% group_by(UPC, prod_name[1]) %>% tally() %>% arrange(desc(n))
upc %>% filter(n>duration)
upc
write.csv(upc, 'd:/cns_data/upc_durations.csv')
rm(UPC)
upc %>% filter(n>duration)
raw_data %>% filter(UPC==30100095) %>% table(date)
raw_data %>% filter(UPC==30100095)
raw_data %>% filter(UPC==30100095) %>% select(date)
unclass(raw_data %>% filter(UPC==30100095) %>% select(date))
table(unclass(raw_data %>% filter(UPC==30100095) %>% select(date))$date)
table(unclass(raw_data %>% filter(UPC==30100095) %>% select(date))$date) ==2
which(table(unclass(raw_data %>% filter(UPC==30100095) %>% select(date))$date) ==2)
table(unclass(raw_data %>% filter(UPC==30100095) %>% select(date) %>% tally()
raw_data %>% filter(UPC==30100095) %>% select(date) %>% tally()
raw_data %>% filter(UPC==30100095) %>% select(date)
raw_data %>% filter(UPC==30100095) %>% select(date) %>% tally()
raw_data %>% filter(UPC==30100095) %>% select(date) %>% table()
raw_data %>% filter(UPC==30100095) %>% select(date) %>% table() != 1
raw_data[raw_data %>% filter(UPC==30100095) %>% select(date) %>% table() != 1,]
raw_data %>% filter(UPC==30100095) %>% select(date) %>% table() != 1
upc %>% filter(n==duration)
raw_data %>% filter(UPC == 34200375)
a = raw_data %>% filter(UPC == 34200375)
length(unique(a$date))
upc$unique_dates = NA
for (i in 1:nrow(upc)){
a = raw_data %>% filter(UPC == upc[i,1])
upc[i,7] = length(unique(a$date))
}
upc
a
raw_data %>% filter(UPC == upc[i,1])
upc[i,1]
unclass(upc[i,1])
upc[i,7] = length(unique(a$date))
for (i in 1:nrow(upc)){
a = raw_data %>% filter(UPC == unclass(upc[i,1])$UPC)
upc[i,7] = length(unique(a$date))
}
upc
upc %>% filter(n==duration, duration==unique_dates)
if_else(upc[1,3]==upc[1,6] & upc[1,6]==upc[1,7], 'T', 'F')
for (i in 1:nrow(upc)){
a = raw_data %>% filter(UPC == unclass(upc[i,1])$UPC)
upc[i,7] = length(unique(a$date))
upc[i,2] = if_else(upc[i,3]==upc[i,6] & upc[i,6]==upc[i,7], 'T', 'F')
}
upc
upc %>% filter(test =='T')
rm(a)
write.csv(upc, 'd:/cns_data/upc_durations.csv')
upc %>% filter(test =='T')
dt = read.csv('d:/cns_data/raw_data_dt.csv)
dt = read.csv('d:/cns_data/raw_data_dt.csv)
dt = read.csv('d:/cns_data/raw_data_dt.csv)
dt = read.csv('d:/cns_data/raw_data_dt.csv)
dt = read.csv('d:/cns_data/raw_data_dt.csv')
dt = read.csv('d:/cns_data/raw_data_dt.csv')
``
dt
dt$득템쿠폰.행사
table(dt$득템쿠폰.행사)
dt %>% filter(dt=='O')
dt %>% filter(득템쿠폰.행사=='O')
dt
dt$promotion
table(dt$promotion)
table(raw_data$promotion)
table(dt$promotion)
dt %>% filter(득템쿠폰.행사=='O')
dt %>% filter(득템쿠폰.행사=='O') %>% filter(promotion=='할인행사')
dt %>% filter(득템쿠폰.행사=='O') %>% filter(promotion=='비할인행사')
dt = read.csv('d:/cns_data/raw_data_dt.csv')
dt %>% filter(득템쿠폰.행사=='O') %>% filter(promotion=='비할인행사')
